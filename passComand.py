import os
import zipfile
import subprocess


def codeFunction(bashCode,nameTool,url):
    print(bashCode)
    code=passCommand(bashCode)
    writeReport(bashCode,nameTool,url)

def passCommand(command):
    code = subprocess.run([command], shell=True)
    return print(code)

def printReport(resultToPrint,nameTool,url):
    print(resultToPrint)
    f=open('./ResultsAudit/'+nameTool+'-'+str(url)+'.txt','+a')
    f.write(str(resultToPrint))
    f.close()

def writeReport(command,nameTool,url):
    route='./ResultsAudit/'+nameTool+'-'+ str(url) +'.txt'
    with open(route, '+a') as archivo:
        process = subprocess.Popen(command.split(), stdout=archivo, stderr=subprocess.PIPE)
        salida, error = process.communicate()


def firtReportName(url,ip,date):
    routeFolder='./ResultsAudit/'
    if not os.path.exists(routeFolder):
        os.makedirs(routeFolder)
        print("La carpeta de reporte ha sido creada")
    else:
        passCommand('rm -rf ./ResultsAudit/')
        firtReportName(url,ip,date)
    f=open(str(routeFolder)+str(url)+".txt",'+a')
    f.write("Reporte de: "+url + "\nip: "+ip +"\ndia: "+date)
    f.close()

def zipResults(dir, ziph):
    for root, dirs, files in os.walk(dir):
        for file in files:
            ziph.write(os.path.join(root, file))