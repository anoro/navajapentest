FROM kalilinux/kali-rolling

# do APT update
RUN apt-get -y update && apt-get -y dist-upgrade && apt-get -y autoremove && apt-get clean
RUN apt update

RUN apt-get -y install git sqlmap commix gobuster nikto xsser --fix-missing
RUN apt-get -y install wpscan dnsutils whatweb python3 python3-pip --fix-missing
RUN apt-get -y install nmap bloodhound neo4j wafw00f wapiti skipfish dirsearch nuclei subfinder --fix-missing
#pip installs python
RUN pip3 install python-nmap scanless 
RUN pip3 install whatweb webanalyzer lxml ldap3
RUN pip install -U webanalyzer whatweb
#Set up packages in the proyect
RUN apt-get -y install pip joomscan subfinder

#update tools
RUN nuclei -update-templates

# install required programs
RUN apt-get -y install vim man --fix-missing
RUN apt-get -y install git sqlmap commix gobuster dirb dirsearch nikto xsser --fix-missing
RUN apt-get -y install nuclei subfinder --fix-missing
RUN apt-get -y install wpscan dnsutils whatweb python3 python3-pip --fix-missing
RUN apt-get -y install nmap bloodhound neo4j subfinder wafw00f wapiti skipfish --fix-missing

# install Python dependencies
RUN pip3 install dirsearch nslookup python-nmap scanless whatweb 
RUN pip3 install pyasn1 ldap3 dnspython pycryptodome ms_active_directory
RUN pip install lxml pyad 
#python-ldap
RUN pip install -U webanalyzer 
RUN pip install --upgrade pip wheel setuptools requests
RUN pip3 install requests --pre
RUN pip3 install requests --upgrade

#update & upgrade all tools
RUN apt-get update && apt upgrade -y

# install project
COPY *.py /root
ADD scan /root/scan/
ADD vulnerabilityScaners /root/vulnerabilityScaners/

##clone the rest of the tools

#impacket
RUN git clone https://github.com/SecureAuthCorp/impacket.git /opt/impacket
RUN pip3 install -r /opt/impacket/requirements.txt
RUN cd /opt/impacket/ && python3 ./setup.py install

#cmsmap
RUN git clone https://github.com/Dionach/CMSmap
RUN pip3 install CMSmap/ 

#copy library lxml to right folder: lib from html5lib -> lxml in webanalizer.py
ADD ./scan/lib/webanalyzer.py /usr/local/lib/python3.11/dist-packages/webanalyzer/


WORKDIR /root
CMD ["/bin/bash"]
